<!DOCTYPE html>
<html>
<head>
  <title>ğŸ· Hog Social ğŸ·</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

  <style>
    body {
      background-color: #ffd6e6;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1, h2 { text-align: center; }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
    }
    button {
      background-color: #8b5e3c;
      color: white;
      padding: 10px;
      border: none;
      margin-top: 10px;
      border-radius: 10px;
      cursor: pointer;
    }
    .post {
      background: white;
      margin-top: 15px;
      padding: 10px;
      border-radius: 10px;
    }
    .oink {
      font-size: 18px;
      cursor: pointer;
      margin-top: 5px;
    }
   function boar(id, currentBoars) {
  const postRef = db.collection("posts").doc(id);
  postRef.get().then(doc => {
    if (!doc.exists) return;
    const data = doc.data();
    const owner = data.user;

    postRef.update({ boars: (currentBoars || 0) + 1 })
      .then(() => {
        if (owner) sendNotification(owner, `${localUsername || 'Someone'} boared your post! ğŸ—`);
      });
  }).catch(err => console.error("Boar error:", err));
}

  </style>
</head>
<body>
<div id="notificationBell" style="cursor:pointer; position:fixed; top:10px; right:10px; font-size:22px;">
  ğŸ”” <span id="notifCount" style="display:none; font-size:12px; color:white; background:red; border-radius:10px; padding:1px 6px;"></span>
</div>

<div id="notificationPanel" style="display:none; position:fixed; top:50px; right:10px; background:white; border:1px solid #ccc; padding:10px; width:300px; max-height:350px; overflow:auto; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.12);"></div>

  
  
<h1>ğŸ· Hog Social</h1>
<h2>Welcome to The Trough</h2>

<input id="username" placeholder="Your hog name..." />
<textarea id="postBox" placeholder="Drop slop in the trough..."></textarea>
<button onclick="addPost()">Post to the Trough</button>

<div id="feed"></div>

<script>
  // 1. PASTE YOUR FIREBASE CONFIG HERE
const firebaseConfig = {
  apiKey: "AIzaSyDoBEl4U6y18gt8Aute2e3xVNZbo7Absj8",
  authDomain: "hog-social-398b6.firebaseapp.com",
  projectId: "hog-social-398b6",
  storageBucket: "hog-social-398b6.firebasestorage.app",
  messagingSenderId: "178343328232",
  appId: "1:178343328232:web:a629bdb1707b688f3ccc5d"
};

  firebase.initializeApp(firebaseConfig);

  const db = firebase.firestore();
  const auth = firebase.auth();

  auth.signInAnonymously();

  function addPost() {
    const user = document.getElementById('username').value || "Anonymous Hog";
    const text = document.getElementById('postBox').value;
    if (!text) return;

  db.collection("posts").add({
  user: user,
  text: text,
  oinks: 0,
  boars: 0, // new downvote field
  createdAt: firebase.firestore.FieldValue.serverTimestamp()
})
.then(() => {
  // Clear the post input box
  document.getElementById('postBox').value = "";

  // Notify all other users about the new post
  db.collection("users").get().then(snapshot => {
    snapshot.forEach(uDoc => {
      const target = uDoc.id;
      if (target && target !== user) {
        sendNotification(target, `${user} posted something new in the Trough! ğŸ–`);
      }
    });
  }).catch(err => console.error("Notification error:", err));
})
.catch(err => console.error(err));


 function oink(id, currentOinks) {
  const postRef = db.collection("posts").doc(id);
  postRef.get().then(doc => {
    if (!doc.exists) return;
    const data = doc.data();
    const owner = data.user;

    postRef.update({ oinks: (currentOinks || 0) + 1 })
      .then(() => {
        if (owner) sendNotification(owner, `${localUsername || 'Someone'} oinked your post! ğŸ·`);
      });
  }).catch(err => console.error(err));
}

  db.collection("posts")
    .orderBy("createdAt", "desc")
    .onSnapshot((snapshot) => {
      const feed = document.getElementById('feed');
      feed.innerHTML = "";

      snapshot.forEach((doc) => {
        const post = doc.data();
        const postId = doc.id;

        let timeStr = "";
try {
  if (post.createdAt) timeStr = post.createdAt.toDate().toLocaleString();
} catch(e) { timeStr = ""; }

feed.innerHTML += `
  <div class="post">
    <strong>${escapeHtml(post.user || 'Anonymous Hog')}</strong><br>
    <div style="margin-top:8px;">
  <span class="oink" onclick="oink('${postId}', ${post.oinks || 0})" title="Oink (upvote)">
    ğŸ· ${post.oinks || 0} oinks
  </span>

  <span class="oink" onclick="boar('${postId}', ${post.boars || 0})" title="Boar (downvote)">
    ğŸ— ${post.boars || 0} boars
  </span>
</div>

function sendNotification(targetUser, message) {
  if (!targetUser) return;
  const notifRef = db.collection("notifications").doc(targetUser).collection("userNotifications");
  notifRef.add({
    message: message,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  }).catch(err => console.error("Notification send error:", err));
}

function listenForNotifications(usernameToListen) {
  if (!usernameToListen) return;
  const notifRef = db.collection("notifications").doc(usernameToListen).collection("userNotifications");

  if (window._hog_notif_unsub) {
    try { window._hog_notif_unsub(); } catch(e) {}
    window._hog_notif_unsub = null;
  }

  window._hog_notif_unsub = notifRef.orderBy("timestamp", "desc").onSnapshot(snapshot => {
    const notifPanel = document.getElementById("notificationPanel");
    const notifCount = document.getElementById("notifCount");
    notifPanel.innerHTML = "";
    let count = 0;
    snapshot.forEach(doc => {
      const d = doc.data();
      const dateStr = d.timestamp ? d.timestamp.toDate().toLocaleString() : "";
      const item = document.createElement("div");
      item.style.padding = "8px";
      item.style.borderBottom = "1px solid #eee";
      item.innerHTML = `<div>${escapeHtml(d.message)}</div><div style="font-size:12px;color:#666">${dateStr}</div>`;
      notifPanel.appendChild(item);
      count++;
    });
    if (count > 0) {
      notifCount.style.display = "inline-block";
      notifCount.textContent = count;
    } else {
      notifCount.style.display = "none";
      notifCount.textContent = "";
    }
  }, err => console.error("Notif listen error:", err));
}

document.getElementById("notificationBell").onclick = () => {
  const panel = document.getElementById("notificationPanel");
  panel.style.display = panel.style.display === "block" ? "none" : "block";
};


</script>
  
</body>
</html>
